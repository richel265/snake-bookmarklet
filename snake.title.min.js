javascript:(function(){"use strict";var grid,snake,currentDirection,moveQueue,hasMoved,GRID_WIDTH=30,SNAKE_CELL=1,FOOD_CELL=2,UP={x:0,y:-1},DOWN={x:0,y:1},LEFT={x:-1,y:0},RIGHT={x:1,y:0},INITIAL_SNAKE_LENGTH=4,gamePaused=!1;function main(){setupEventHandlers(),startGame();var e=Date.now();window.requestAnimationFrame((function t(){var n=Date.now();!gamePaused&&n-e>=tickTime()&&(updateWorld(),drawWorld(),e=n),window.requestAnimationFrame(t)}))}function setupEventHandlers(){var e={37:LEFT,38:UP,39:RIGHT,40:DOWN,87:UP,65:LEFT,83:DOWN,68:RIGHT,75:UP,72:LEFT,74:DOWN,76:RIGHT};document.onkeydown=function(t){var n=t.keyCode;n in e&&changeDirection(e[n])},window.onblur=function(){gamePaused=!0,document.title=document.title+"[paused]"},window.onfocus=function(){gamePaused=!1,drawWorld()}}function startGame(){grid=new Array(4*GRID_WIDTH),snake=[];for(var e=0;e<INITIAL_SNAKE_LENGTH;e++){snake.unshift({x:e,y:2}),setCellAt(e,2,SNAKE_CELL)}currentDirection=RIGHT,moveQueue=[],hasMoved=!1,dropFood()}function updateWorld(){moveQueue.length&&(currentDirection=moveQueue.pop());var e=snake[0],t=snake[snake.length-1],n=e.x+currentDirection.x,r=e.y+currentDirection.y,o=n<0||n>=GRID_WIDTH||r<0||r>=4,i=cellAt(n,r)===SNAKE_CELL&&!(n===t.x&&r===t.y);if(o||i)return endGame(),void startGame();var a=cellAt(n,r)===FOOD_CELL;a||(snake.pop(),setCellAt(t.x,t.y,null)),setCellAt(n,r,SNAKE_CELL),snake.unshift({x:n,y:r}),a&&dropFood()}function endGame(){var e=currentScore(),t=parseInt(localStorage.maxScore||0);e>0&&e>t&&hasMoved&&(localStorage.maxScore=e,localStorage.maxScoreGrid=gridString(),drawMaxScore(),showMaxScore())}function drawWorld(){var e=gridString()+"|[score:"+currentScore()+"]";document.title=e}function gridString(){for(var e="",t=0;t<GRID_WIDTH;t+=2){var n=0|bitAt(t,0)<<0|bitAt(t,1)<<1|bitAt(t,2)<<2|bitAt(t+1,0)<<3|bitAt(t+1,1)<<4|bitAt(t+1,2)<<5|bitAt(t,3)<<6|bitAt(t+1,3)<<7;e+=String.fromCharCode(10240+n)}return e}function tickTime(){return 125+-50*snake.length/grid.length}function currentScore(){return snake.length-INITIAL_SNAKE_LENGTH}function cellAt(e,t){return grid[e%GRID_WIDTH+t*GRID_WIDTH]}function bitAt(e,t){return cellAt(e,t)?1:0}function setCellAt(e,t,n){grid[e%GRID_WIDTH+t*GRID_WIDTH]=n}function dropFood(){var e=grid.length-snake.length;if(0!==e)for(var t=Math.floor(Math.random()*e),n=0;n<grid.length;n++)if(grid[n]!==SNAKE_CELL){if(0===t){grid[n]=FOOD_CELL;break}t--}}function changeDirection(e){var t=moveQueue[0]||currentDirection;e.x+t.x===0&&e.y+t.y===0||moveQueue.unshift(e),hasMoved=!0}main();}());
